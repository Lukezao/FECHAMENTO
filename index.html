<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <!-- Meta tag viewport para dispositivos móveis -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fechamento Financeiro do Show</title>
    <style>
      /* Estilos básicos */
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        /* Ajuste para telas menores */
        font-size: 16px;
      }
      h1, h2, h3 {
        color: #333;
      }
      label {
        display: block;
        margin-top: 10px;
      }
      input, textarea {
        width: 100%; /* Ajuste para 100% da largura */
        padding: 5px;
        box-sizing: border-box;
      }
      button {
        margin-top: 10px;
        padding: 10px 15px;
        background-color: #0288D1;
        color: #fff;
        border: none;
        cursor: pointer;
        width: 100%; /* Botões ocupam toda a largura em telas menores */
      }
      button:hover {
        background-color: #02669B;
      }
      table {
        width: 100%; /* Ajuste para 100% da largura */
        border-collapse: collapse;
        margin-top: 15px;
      }
      table, th, td {
        border: 1px solid #ddd;
      }
      th, td {
        padding: 8px;
        text-align: left;
      }
      #total {
        font-weight: bold;
        margin-top: 15px;
      }
      /* Media query para telas menores */
      @media (max-width: 600px) {
        body {
          font-size: 18px; /* Aumenta o tamanho da fonte em telas pequenas */
        }
        button {
          font-size: 18px;
        }
        th, td {
          font-size: 16px;
        }
      }
    </style>
    <!-- Importa a biblioteca jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>
  <body>
    <h1>Fechamento Financeiro do Show</h1>
    <!-- Formulário do Show -->
    <h2>Dados do Show</h2>
    <form id="show-form">
      <label for="data">Data:</label>
      <input type="date" id="data" required>

      <label for="local">Local do Show:</label>
      <input type="text" id="local" required>

      <label for="valor-show">Valor do Show:</label>
      <input type="number" id="valor-show" step="0.01" required>

      <label for="vendedor">Vendedor:</label>
      <input type="text" id="vendedor" required>
    </form>

    <!-- Formulário da Equipe -->
    <h2>Equipe</h2>
    <form id="equipe-form">
      <label for="nome">Nome:</label>
      <input type="text" id="nome" required>

      <label for="funcao">Função:</label>
      <input type="text" id="funcao" required>

      <label for="valor-equipe">Valor:</label>
      <input type="number" id="valor-equipe" step="0.01" required>

      <button type="button" onclick="adicionarMembro()">Adicionar Membro</button>
    </form>

    <!-- Tabela da Equipe -->
    <h3>Membros da Equipe</h3>
    <table id="tabela-equipe">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Função</th>
          <th>Valor</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <!-- Membros da equipe serão adicionados aqui -->
      </tbody>
    </table>

    <!-- Total -->
    <h2>Total</h2>
    <p id="total">Valor do Show: R$ 0.00<br>Total da Equipe: R$ 0.00<br>Total Geral: R$ 0.00</p>

    <!-- Botão para gerar PDF -->
    <button type="button" onclick="gerarPDF()">Exportar em PDF</button>

    <!-- Scripts -->
    <script>
      // Encapsulamento do código em uma função anônima
      (function() {
        // Variável global para armazenar os membros da equipe
        window.equipe = [];

        // Função para adicionar um membro à equipe
        window.adicionarMembro = function() {
          const nome = document.getElementById('nome').value.trim();
          const funcao = document.getElementById('funcao').value.trim();
          const valorInput = document.getElementById('valor-equipe').value;
          const valor = parseFloat(valorInput);

          if (nome && funcao && !isNaN(valor)) {
            const membro = { nome, funcao, valor };
            equipe.push(membro);
            atualizarTabela();
            document.getElementById('equipe-form').reset();
            calcularTotal();
          } else {
            alert('Por favor, preencha todos os campos da equipe corretamente.');
          }
        };

        // Função para remover um membro da equipe
        window.removerMembro = function(index) {
          if (confirm('Deseja realmente remover este membro?')) {
            equipe.splice(index, 1);
            atualizarTabela();
            calcularTotal();
          }
        };

        // Função para atualizar a tabela de membros da equipe
        window.atualizarTabela = function() {
          const tbody = document.querySelector('#tabela-equipe tbody');
          tbody.innerHTML = '';
          equipe.forEach((membro, index) => {
            const tr = document.createElement('tr');

            const tdNome = document.createElement('td');
            tdNome.textContent = membro.nome;
            tr.appendChild(tdNome);

            const tdFuncao = document.createElement('td');
            tdFuncao.textContent = membro.funcao;
            tr.appendChild(tdFuncao);

            const tdValor = document.createElement('td');
            tdValor.textContent = `R$ ${membro.valor.toFixed(2)}`;
            tr.appendChild(tdValor);

            const tdAcoes = document.createElement('td');
            const btnRemover = document.createElement('button');
            btnRemover.textContent = 'Remover';
            btnRemover.style.backgroundColor = '#E53935';
            btnRemover.style.color = '#fff';
            btnRemover.style.border = 'none';
            btnRemover.style.padding = '5px 10px';
            btnRemover.style.cursor = 'pointer';
            btnRemover.onclick = function() { removerMembro(index); };
            tdAcoes.appendChild(btnRemover);
            tr.appendChild(tdAcoes);

            tbody.appendChild(tr);
          });
        };

        // Função para calcular os totais
        window.calcularTotal = function() {
          const valorShowInput = document.getElementById('valor-show').value;
          const valorShow = parseFloat(valorShowInput) || 0;
          const totalEquipe = equipe.reduce((acc, membro) => acc + membro.valor, 0);
          const totalGeral = valorShow + totalEquipe;

          document.getElementById('total').innerHTML = `
            Valor do Show: R$ ${valorShow.toFixed(2)}<br>
            Total da Equipe: R$ ${totalEquipe.toFixed(2)}<br>
            Total Geral: R$ ${totalGeral.toFixed(2)}
          `;
        };

        // Função para gerar o PDF
        window.gerarPDF = function() {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // Dados do show
          const data = document.getElementById('data').value;
          const local = document.getElementById('local').value.trim();
          const valorShowInput = document.getElementById('valor-show').value;
          const valorShow = parseFloat(valorShowInput);
          const vendedor = document.getElementById('vendedor').value.trim();

          if (!data || !local || isNaN(valorShow) || !vendedor) {
            alert('Por favor, preencha todos os campos do show corretamente.');
            return;
          }

          let yPosition = 10;
          doc.setFontSize(16);
          doc.text('Fechamento Financeiro do Show', 10, yPosition);
          yPosition += 10;

          doc.setFontSize(12);
          doc.text(`Data: ${data}`, 10, yPosition);
          yPosition += 7;
          doc.text(`Local do Show: ${local}`, 10, yPosition);
          yPosition += 7;
          doc.text(`Valor do Show: R$ ${valorShow.toFixed(2)}`, 10, yPosition);
          yPosition += 7;
          doc.text(`Vendedor: ${vendedor}`, 10, yPosition);
          yPosition += 10;

          // Dados da equipe
          doc.setFontSize(14);
          doc.text('Equipe:', 10, yPosition);
          yPosition += 7;

          doc.setFontSize(12);
          equipe.forEach((membro) => {
            doc.text(`Nome: ${membro.nome}, Função: ${membro.funcao}, Valor: R$ ${membro.valor.toFixed(2)}`, 10, yPosition);
            yPosition += 7;
            // Verifica se está perto do final da página
            if (yPosition > 280) {
              doc.addPage();
              yPosition = 10;
            }
          });

          // Totais
          const totalEquipe = equipe.reduce((acc, membro) => acc + membro.valor, 0);
          const totalGeral = valorShow + totalEquipe;

          yPosition += 10;
          doc.setFontSize(14);
          doc.text('Totais:', 10, yPosition);
          yPosition += 7;

          doc.setFontSize(12);
          doc.text(`Total da Equipe: R$ ${totalEquipe.toFixed(2)}`, 10, yPosition);
          yPosition += 7;
          doc.text(`Total Geral: R$ ${totalGeral.toFixed(2)}`, 10, yPosition);

          // Salva o PDF
          doc.save('fechamento_financeiro.pdf');
        };

        // Atualiza o total quando o valor do show é alterado
        document.getElementById('valor-show').addEventListener('input', calcularTotal);

      })(); // Fim da função anônima
    </script>
  </body>
</html>
